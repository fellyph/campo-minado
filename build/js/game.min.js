function loadGame(a){var b=JSON.parse(localStorage.getItem("oldgame"));initGame(b.level),gameConfig.map=b.map,gameConfig.bombsList=b.bombsList,gameConfig.clickedNum=b.clickedNum,gameConfig.flagsNum=b.flagsNum,gameConfig.loadedGame=!0,seconds=b.seconds,document.getElementById("timer").innerHTML="Timer: "+seconds;for(var c=gameConfig.level[gameConfig.currentLevel].cols,d=gameConfig.level[gameConfig.currentLevel].rows,e=0;d>e;e++)for(var f=0;c>f;f++)gameConfig.map[e][f].clicked===!0&&clearBox(e*gameConfig.width,f*gameConfig.height,gameConfig.map[e][f].nearBombs),gameConfig.map[e][f].haveFlag===!0&&addFlag(e*gameConfig.width,f*gameConfig.height)}function selectLevel(a){var b;this.dataset.level?(b=this.dataset.level,localStorage.setItem("currentLevel",b)):b=gameConfig.currentLevel,initGame(b);for(var c=0;c<btnsLevel.length;c++)btnsLevel[c].className="set-level";btnsLevel[b].className="set-level current"}function tryCheat(a){if(gameConfig.bombsList.length-gameConfig.flagsNum===0){var b=0;for(var c in gameConfig.bombsList)gameConfig.map[gameConfig.bombsList[c][0]][gameConfig.bombsList[c][1]].haveFlag&&b++;gameConfig.bombsList.length==b?youWin():gameOver()}}function onClickGame(a){mouseX=a.pageX-a.target.offsetLeft,mouseY=a.pageY-a.target.offsetTop,timerStarted||(timer=setInterval(countTimer,1e3),timerStarted=!0),clickedX=Math.floor(mouseX/gameConfig.width),clickedY=Math.floor(mouseY/gameConfig.height),gameConfig.map[clickedX][clickedY].haveBomb===!0?gameOver():gameConfig.map[clickedX][clickedY].clicked!==!1||youlose||(gameConfig.map[clickedX][clickedY].clicked=!0,youStillAlive(clickedX,clickedY),btSave.disabled=!1)}function onRightClickGame(a){a.preventDefault(),timerStarted||(timer=setInterval(countTimer,1e3),timerStarted=!0),mouseX=a.pageX-a.target.offsetLeft,mouseY=a.pageY-a.target.offsetTop,totalBombs=gameConfig.bombsList.length,clickedXFlag=Math.floor(mouseX/gameConfig.width),clickedYFlag=Math.floor(mouseY/gameConfig.height),gameConfig.map[clickedXFlag][clickedYFlag].clicked||(!gameConfig.map[clickedXFlag][clickedYFlag].haveFlag&&gameConfig.flagsNum<totalBombs?(addFlag(clickedXFlag*gameConfig.width,clickedYFlag*gameConfig.height),gameConfig.map[clickedXFlag][clickedYFlag].haveFlag=!0,gameConfig.flagsNum++,gameConfig.flagsNum+gameConfig.clickedNum==gameConfig.totalBlocks&&youWin()):(removeFlag(clickedXFlag*gameConfig.width,clickedYFlag*gameConfig.height),gameConfig.map[clickedXFlag][clickedYFlag].haveFlag=!1,gameConfig.flagsNum--),document.getElementById("flags").innerHTML="FLAGS: "+(totalBombs-gameConfig.flagsNum))}function youWin(){clearInterval(timer),localStorage.clear(),document.getElementById("game").className+=" you-win",btSave.disabled=!0,document.getElementsByClassName("title-game")[0].innerHTML="YOU WIN!"}function addFlag(a,b){ctx.beginPath(),ctx.lineWidth=3,ctx.strokeStyle="#ffffff",ctx.moveTo(a+4,b+4),ctx.lineTo(a+4,b+gameConfig.height-4),ctx.stroke(),ctx.closePath(),ctx.beginPath(),ctx.moveTo(a+8,b+5),ctx.lineTo(a+gameConfig.width-8,b+gameConfig.height/4),ctx.lineTo(a+8,b+gameConfig.height/2),ctx.lineTo(a+8,b+5),ctx.fillStyle=ctx.strokeStyle="#ff0000",ctx.fill(),ctx.stroke()}function removeFlag(a,b){ctx.beginPath(),ctx.lineWidth=1,ctx.rect(a,b,gameConfig.width,gameConfig.height),ctx.strokeStyle="#ffffff",ctx.fillStyle=gameConfig.color,ctx.fill(),ctx.stroke()}function initGame(a){gameConfig.currentLevel=a,gameConfig.map=[],gameConfig.flagsNum=0,gameConfig.clickedNum=0,document.getElementById("game").className="container",document.getElementsByClassName("title-game")[0].innerHTML="Minesweeper",btSave.disabled=!0,youlose=!1,canvas.width=gameConfig.width*gameConfig.level[gameConfig.currentLevel].cols,canvas.height=gameConfig.height*gameConfig.level[gameConfig.currentLevel].rows,document.getElementById("flags").innerHTML="Flags: "+gameConfig.level[gameConfig.currentLevel].bombsNum,timerStarted&&(clearInterval(timer),timerStarted=!1,seconds=0,document.getElementById("timer").innerHTML="Timer: 0"),drawStage(),sortBombs(),canvas.addEventListener("click",onClickGame),canvas.addEventListener("contextmenu",onRightClickGame),document.getElementById("smile").addEventListener("click",tryCheat)}function countTimer(){seconds++,document.getElementById("timer").innerHTML="Timer: "+seconds}function sortBombs(){for(gameConfig.bombsList=[];gameConfig.bombsList.length<gameConfig.level[gameConfig.currentLevel].bombsNum;){var a=Math.floor(Math.random()*gameConfig.level[gameConfig.currentLevel].cols),b=Math.floor(Math.random()*gameConfig.level[gameConfig.currentLevel].rows);gameConfig.map[a][b].haveBomb!==!0&&(gameConfig.map[a][b].haveBomb=!0,gameConfig.bombsList.push([a,b]))}}function gameOver(){youlose=!0,gameConfig.loadedGame===!0&&(localStorage.removeItem("oldgame"),gameConfig.loadedGame=!1,btLoad.disabled=!0),clearInterval(timer);for(var a=0;a<gameConfig.bombsList.length;a++){var b=gameConfig.bombsList[a][0]*gameConfig.width,c=gameConfig.bombsList[a][1]*gameConfig.height;ctx.fillStyle="#DD0000",ctx.fillRect(b,c,gameConfig.width,gameConfig.height)}document.getElementById("game").className+=" game-over",document.getElementsByClassName("title-game")[0].innerHTML="GAMER OVER",btSave.disabled=!0}function youStillAlive(a,b){var c=0;for(var d in boxesToCheck)for(var e=0;e<gameConfig.level[gameConfig.currentLevel].bombsNum;e++)checkBase(e,a+boxesToCheck[d][0],b+boxesToCheck[d][1])&&c++;if(gameConfig.map[a][b].nearBombs=c,gameConfig.map[a][b].clicked=!0,gameConfig.clickedNum++,gameConfig.flagsNum+gameConfig.clickedNum==gameConfig.totalBlocks&&youWin(),clearBox(a*gameConfig.width,b*gameConfig.height,c),0===c)for(var f in boxesToCheck)if(a+boxesToCheck[f][0]>=0&&a+boxesToCheck[f][0]<gameConfig.level[gameConfig.currentLevel].cols&&b+boxesToCheck[f][1]>=0&&b+boxesToCheck[f][1]<gameConfig.level[gameConfig.currentLevel].rows){var g=a+boxesToCheck[f][0],h=b+boxesToCheck[f][1];gameConfig.map[g][h].clicked||youStillAlive(g,h)}}function clearBox(a,b,c){ctx.clearRect(a,b,gameConfig.width,gameConfig.height),ctx.fillStyle="#000000",ctx.font="20px Arial",ctx.fillText(c,a+.4*gameConfig.width,b+.7*gameConfig.height)}function checkBase(a,b,c){return gameConfig.bombsList[a][0]==b&&gameConfig.bombsList[a][1]==c?!0:!1}function drawStage(){ctx.clearRect(0,0,canvas.width,canvas.height);var a=gameConfig.level[gameConfig.currentLevel].cols,b=gameConfig.level[gameConfig.currentLevel].rows;gameConfig.totalBlocks=a*b;for(var c=0;b>c;c++){for(var d=[],e=0;a>e;e++){d[e]={clicked:!1,haveBomb:!1,nearBombs:0,haveFlag:!1};var f=e*gameConfig.width,g=c*gameConfig.height;ctx.beginPath(),ctx.lineWidth=1,ctx.rect(f,g,gameConfig.width,gameConfig.height),ctx.strokeStyle="#ffffff",ctx.fillStyle=gameConfig.color,ctx.fill(),ctx.stroke()}gameConfig.map[c]=d}}function saveGame(a){if(!youlose){var b={level:gameConfig.currentLevel,map:gameConfig.map,bombsList:gameConfig.bombsList,seconds:seconds,clickedNum:gameConfig.clickedNum,flagsNum:gameConfig.flagsNum};localStorage.setItem("oldgame",JSON.stringify(b)),btLoad.disabled=!1,btLoad.addEventListener("click",loadGame)}}var gameConfig={level:[{rows:8,cols:8,bombsNum:10},{rows:12,cols:12,bombsNum:25},{rows:18,cols:18,bombsNum:40}],currentLevel:0,width:50,height:50,spaceBox:3,color:"#333333",bombsList:[],flagsNum:0,clickedNum:0,map:[],loadedGame:!1,totalBlocks:0},ctx,canvas,countrows=0,countcols=0,mouseX,mouseY,youlose=!1,timer,seconds=0,btnsLevel,timerStarted=!1,btSave,btLoad,btNew,boxesToCheck=[[1,1],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1],[1,-1],[1,0]],clickedBases=[];window.addEventListener("load",function(){canvas=document.getElementById("my-canvas"),ctx=canvas.getContext("2d"),btLoad=document.getElementById("bt-load"),btSave=document.getElementById("bt-save"),btNew=document.getElementById("bt-new"),localStorage.getItem("currentLevel")?(gameConfig.currentLevel=localStorage.getItem("currentLevel"),initGame(gameConfig.currentLevel),document.getElementsByClassName("set-level")[gameConfig.currentLevel].className="set-level current"):(initGame(0),document.getElementsByClassName("set-level")[0].className="set-level current"),localStorage.getItem("oldgame")?btLoad.addEventListener("click",loadGame):btLoad.disabled=!0,btnsLevel=document.getElementsByClassName("set-level");for(var a=0;a<btnsLevel.length;a++)btnsLevel[a].addEventListener("click",selectLevel);btSave.addEventListener("click",saveGame),btNew.addEventListener("click",selectLevel)});